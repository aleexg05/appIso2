<!doctype html>
<html lang="ca">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Llista estudiants</title>
    <style>
      .page-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        padding: 20px;
      }
      .table thead th {
        background: #f4f4f9;
        border-bottom: 2px solid #e2e2e2;
      }
      #message {
        display: none;
      }
      #message.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container" style="margin-top: 20px;">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h1 class="h4 mb-1">Llista d'estudiants</h1>
        </div>
        <a class="btn btn-success" href="/create.html">Afegir estudiant</a>
      </div>

      <div id="message" class="alert" role="alert"></div>

      <div class="page-card">
        <div id="loading" class="text-center text-muted" style="padding: 40px;">
          Carregant estudiants...
        </div>

        <div id="content" style="display: none;">
          <div id="emptyState" style="text-align: center; padding: 40px;" style="display: none;">
            <p class="text-muted">No hi ha estudiants registrats.</p>
          </div>
          
          <div id="tableContainer" class="table-responsive" style="display: none;">
            <table class="table align-middle mb-0" id="studentTable">
              <thead>
                <tr>
                  <th scope="col">Nom</th>
                  <th scope="col">Email</th>
                  <th scope="col">Adre√ßa</th>
                  <th scope="col" class="text-right">Accions</th>
                </tr>
              </thead>
              <tbody id="studentList">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        const API_URL = '';

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function loadStudents() {
            try {
                const response = await fetch(`${API_URL}/api/students`);
                if (!response.ok) throw new Error('Error carregant estudiants');
                
                const students = await response.json();
                
                const studentList = document.getElementById('studentList');
                const emptyState = document.getElementById('emptyState');
                const tableContainer = document.getElementById('tableContainer');
                const loading = document.getElementById('loading');
                const content = document.getElementById('content');

                studentList.innerHTML = '';

                if (students.length === 0) {
                    emptyState.style.display = 'block';
                    tableContainer.style.display = 'none';
                } else {
                    emptyState.style.display = 'none';
                    tableContainer.style.display = 'block';
                    students.forEach(student => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="font-weight-bold">${escapeHtml(student.name)}</td>
                            <td>${escapeHtml(student.email)}</td>
                            <td>${escapeHtml(student.address)}</td>
                            <td class="text-right">
                                <a href="/edit.html?id=${student.id}" class="btn btn-primary btn-sm">Editar</a>
                                <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">Eliminar</button>
                            </td>
                        `;
                        studentList.appendChild(row);
                    });
                }

                loading.style.display = 'none';
                content.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                showMessage('Error carregant estudiants', 'alert-danger');
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function deleteStudent(id) {
            if (!confirm('Aquesta accio esborrara aquest estudiant.')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/students/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Error eliminant estudiant');

                showMessage('Estudiant eliminat correctament', 'alert-success');
                loadStudents();
            } catch (error) {
                console.error('Error:', error);
                showMessage('Error eliminant estudiant', 'alert-danger');
            }
        }

        function showMessage(msg, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = msg;
            messageEl.className = `alert ${type} show`;
            
            setTimeout(() => {
                messageEl.classList.remove('show');
                messageEl.className = 'alert';
            }, 3000);
        }

        loadStudents();
    </script>
  </body>
</html>
